<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">
  <style>
    @import url('https://fonts.googleapis.com/css?family=Raleway:300');


    text {
      font-family: 'Raleway', sans-serif;

      -webkit-touch-callout: none; /* iOS Safari */
      -webkit-user-select: none; /* Safari */
      -khtml-user-select: none; /* Konqueror HTML */
      -moz-user-select: none; /* Firefox */
      -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none; /* Non-prefixed version, currently
            supported by Chrome and Opera */
          }
          html{
            height:99vh;

          }
          body{
            margin: 0px;
          }
          .links line {
            stroke: #999;
            stroke-opacity: 0.6;
          }

          .nodes circle {
            stroke: #fff;
            stroke-width: 1.5px;
            opacity: 0.8;
          }
/*.background{
  position: fixed;
  color: #fff;
  width: 250;
  height: 80;
}*/
.sidebar {
  background-color: #282828;

  position: fixed;
}
.frame{

  color: #fff;

}
.def{
  display:block;
  text-align: center;
  color: #fff;
}

svg {
  display: block;
  margin: 0 auto;
  width: 100%;
  height:99.5vh;
}

</style>
</head>
<body style="margin: 0px;">


  <div class="sidebar" width="250" height="80" >
    <div class="def" style="margin:3px;" width="250" height="80" > 
      <text>Select Band or Solo Artist</text>
    </div>
    <iframe class="frame" src="" width="250" height="83" frameborder="0" allowtransparency="true"></iframe>
  </div>


  <svg width="960" height="600"></svg>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script>



    var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

    var color = d3.scaleOrdinal(d3.schemeCategory20);

    var simulation = d3.forceSimulation()
    .force("link", d3.forceLink().id(function(d) { return d.id; })
      )
    .force("center", d3.forceCenter(width / 2, height / 2))
    ;
    d3.json("./chains.json", function(error, graph) {
      if (error) throw error;

      var link = svg.append("g")
      .attr("class", "links")
      .selectAll("line")
      .data(graph.links)
      .enter().append("line")
      .attr("stroke-width", function(d) { return Math.sqrt(d.value); });

      var node = svg.append("g")
      .attr("class", "nodes")
      .selectAll("circle")
      .data(graph.nodes)
      .enter().append("circle")
      .attr("r", 10)
      .attr("fill", function(d) { return color(d.group); })
      .call(d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended))
      ;

  //var g = svg.append("g");

  var texts = svg.append("g")
  .attr("class","labels")
  .selectAll("text.label")
  .data(graph.nodes)
  .enter().append("text")
  .attr("class", "label")
  .attr("fill", "black")
  .attr("dx", function(d){return 9})
  .text(function(d) {  return d.id;  });

  // node.append("title")
  //     .attr("dx", function(d){return -20})
  //     .text(function(d) { return d.id; });

  simulation
  .nodes(graph.nodes)
  .force("charge", d3.forceManyBody().strength(function(d) {
     d.weight = link.filter(function(l) {
       console.log(l.source);
       return l.source == d.id || l.target.index == d.index
     }).size(); 

   return (d.weight*-150)-100; }).distanceMax(300))
  .force("collide", d3.forceCollide().radius(function(d) { return 10; }))
  .on("tick", ticked);

  simulation.force("link")
  .links(graph.links)

  .force("charge",d3.forceManyBody().strength(-10));



  function ticked() {
    link
    .attr("x1", function(d) { return d.source.x; })
    .attr("y1", function(d) { return d.source.y; })
    .attr("x2", function(d) { return d.target.x; })
    .attr("y2", function(d) { return d.target.y; });

    node
    .attr("cx", function(d) { return d.x; })
    .attr("cy", function(d) { return d.y; });

    texts.attr("transform", function(d) {
      return "translate(" + d.x+10 + "," + d.y+10 + ")";
    });
  }



});

    function dragstarted(d) {
      d3.select(".def")
      .attr("visibility","hidden")
      ;
      if (!d3.event.active) simulation.alphaTarget(0.3).restart();
      d.fx = d.x;
      d.fy = d.y;
      if(d.group!=3){
        if(d.group!=1){
          d3.select(".frame")
          .attr("src",d.src)
          ;
        }
      }
    }

    function dragged(d) {
      d.fx = d3.event.x;
      d.fy = d3.event.y;
    }

    function dragended(d) {
      if (!d3.event.active) simulation.alphaTarget(0);
      d.fx = null;
      d.fy = null;
    }

  </script>
</body>
</html>